# План повышения готовности к Production до 95%

**Проект:** Client Analyze Agent  
**Дата:** 25 декабря 2025  
**Текущий уровень:** 85% (8.5/10)  
**Целевой уровень:** 95% (9.5/10)  
**Срок реализации:** 3 недели (15 рабочих дней)

---

## Executive Summary

Для достижения 95% готовности к production необходимо закрыть задачи в пяти направлениях:

| Спринт | Фокус | Приоритет | Дни |
|--------|-------|-----------|-----|
| 1 | Backend Hardening | P0/P1 | 1-5 |
| 2 | QA & Testing | P1 | 6-10 |
| 3 | SRE & Observability | P1/P2 | 11-15 |
| 4 | Frontend & Documentation | P2 | 16-20 |
| 5 | UX Improvements | P2 | 21-25 |

**Общий срок:** 5 недель (25 рабочих дней)  
**MVP (95% готовность):** 3 недели (Спринты 1-3)  
**Полная готовность:** 5 недель (все спринты)

---

## Текущие пробелы и риски

| Категория | Пробел | Риск для Production | Приоритет |
|-----------|--------|---------------------|-----------|
| Функциональность | TODO методы в repositories | Нет истории аудита, невозможен экспорт | P0 |
| Надёжность | Raw dict вместо Pydantic в health endpoints | Нестабильный API контракт | P1 |
| Тестирование | Нет интеграционных тестов feedback + RabbitMQ | Регрессии в критичных путях | P1 |
| Мониторинг | Нет алертов на DLQ | Потеря сообщений незаметна | P1 |
| Документация | API specs только для 2 из 5 источников | MCP guidance неполный | P2 |
| Конфигурация | Hardcoded feature flags | Сложность управления окружениями | P2 |
| Код | Неинформативные комментарии, документация не на русском | Сложность поддержки | P2 |
| Фронтенд | 15+ API endpoints не вызываются на UI | Неполная функциональность | P2 |
| UX | Отсутствует аналитика, управление задачами, bulk-операции | Слабый пользовательский опыт | P2 |

---

## План работ по спринтам

### Спринт 1: Backend Hardening (Дни 1-5)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 1.1 | Реализовать методы list, delete, search, count в threads_repository.py | Backend | 2 дня | - |
| 1.2 | Реализовать методы list, delete в cache_repository.py | Backend | 1 день | - |
| 1.3 | Добавить Pydantic response models в utility health/metrics endpoints | Backend | 1 день | 1.1, 1.2 |
| 1.4 | Smoke-тесты Tarantool connectivity | Backend | 1 день | 1.1, 1.2 |

**Критерии успеха Спринта 1:**
- Все CRUD операции в repositories работают
- LSP ошибки типизации устранены
- Tarantool smoke-тесты проходят в CI

---

### Спринт 2: QA & Testing (Дни 6-10)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 2.1 | Интеграционные тесты feedback API с rerun=true | QA | 1.5 дня | Спринт 1 |
| 2.2 | Интеграционные тесты RabbitMQ (publish, consume, DLQ) | QA | 1.5 дня | Спринт 1 |
| 2.3 | E2E тест полного workflow (INN → PDF report) | QA | 1 день | 2.1, 2.2 |
| 2.4 | Настройка test harness с in-memory broker | QA | 1 день | - |

**Критерии успеха Спринта 2:**
- Тестовое покрытие критичных путей > 80%
- CI pipeline зелёный на всех тестах
- Время выполнения тестов < 5 минут

---

### Спринт 3: SRE & Observability (Дни 11-15)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 3.1 | DLQ мониторинг: Prometheus gauges + alert rules | SRE | 1.5 дня | Спринт 2 |
| 3.2 | Dashboard tiles для DLQ в Grafana | SRE | 0.5 дня | 3.1 |
| 3.3 | API specs для Perplexity, Tavily, InfoSphere | SRE/Docs | 1.5 дня | - |
| 3.4 | Миграция FeatureFlags в YAML/Settings | Backend | 1 день | - |
| 3.5 | Документация change management | SRE | 0.5 дня | 3.4 |

**Критерии успеха Спринта 3:**
- Алерты на DLQ срабатывают при накоплении > 10 сообщений
- MCP server имеет specs для всех 5 API источников
- Feature flags управляются через конфигурацию

---

### Спринт 4: Frontend & Documentation (P2) (Дни 16-20)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 4.1 | Рефакторинг комментариев: удаление неинформативных, docstrings на русском | Backend | 1.5 дня | Спринт 1 |
| 4.2 | Новый таб "Аналитика" на фронтенде (dashboard, trends, comparison) | Frontend | 2 дня | - |
| 4.3 | Управление задачами планировщика (список, удаление, статус) | Frontend | 1 день | - |
| 4.4 | Bulk-операции с отчётами (массовый экспорт, удаление) | Frontend | 1 день | - |
| 4.5 | Просмотр истории потоков анализа (threads) | Frontend | 0.5 дня | Спринт 1 (1.1) |

**Критерии успеха Спринта 4:**
- Все публичные функции и классы имеют docstrings на русском
- Неинформативные комментарии удалены
- Новые API endpoints доступны через UI
- Пользователь может управлять задачами планировщика

---

### Спринт 5: UX Improvements (P2) (Дни 21-25)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 5.1 | Inline валидация форм с мгновенной обратной связью | Frontend | 1 день | - |
| 5.2 | Skeleton loaders для длительных операций | Frontend | 0.5 дня | - |
| 5.3 | Toast-уведомления вместо st.error/st.success | Frontend | 1 день | - |
| 5.4 | Progressive disclosure для расширенных настроек | Frontend | 0.5 дня | - |
| 5.5 | Breadcrumbs для навигации в отчётах | Frontend | 0.5 дня | - |
| 5.6 | Empty-state иллюстрации и onboarding tour | Frontend | 1 день | - |
| 5.7 | Accessibility: ARIA labels, контраст, keyboard navigation | Frontend | 0.5 дня | - |

**Критерии успеха Спринта 5:**
- UX Score повышен (субъективная оценка пользователей)
- Время выполнения типичных задач сокращено
- Accessibility аудит пройден

---

## Диаграмма зависимостей

```
                    ┌─────────────────────────────────────────┐
                    │           СПРИНТ 1 (Backend)            │
                    │                                         │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 1.1 threads │   │ 1.2 cache   │     │
                    │  │ repository  │   │ repository  │     │
                    │  └──────┬──────┘   └──────┬──────┘     │
                    │         │                 │            │
                    │         └────────┬────────┘            │
                    │                  ▼                     │
                    │         ┌─────────────────┐            │
                    │         │ 1.3 Pydantic    │            │
                    │         │ responses       │            │
                    │         └────────┬────────┘            │
                    │                  │                     │
                    │                  ▼                     │
                    │         ┌─────────────────┐            │
                    │         │ 1.4 Smoke tests │            │
                    │         └────────┬────────┘            │
                    └──────────────────┼─────────────────────┘
                                       │
                                       ▼
                    ┌─────────────────────────────────────────┐
                    │           СПРИНТ 2 (QA)                 │
                    │                                         │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 2.1 feedback│   │ 2.2 RabbitMQ│     │
                    │  │ tests       │   │ tests       │     │
                    │  └──────┬──────┘   └──────┬──────┘     │
                    │         │                 │            │
                    │         └────────┬────────┘            │
                    │                  ▼                     │
                    │         ┌─────────────────┐            │
                    │         │ 2.3 E2E workflow│            │
                    │         └────────┬────────┘            │
                    └──────────────────┼─────────────────────┘
                                       │
                                       ▼
                    ┌─────────────────────────────────────────┐
                    │           СПРИНТ 3 (SRE)                │
                    │                                         │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 3.1 DLQ     │   │ 3.3 API     │     │
                    │  │ monitoring  │   │ specs       │     │
                    │  └──────┬──────┘   └─────────────┘     │
                    │         │                              │
                    │         ▼                              │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 3.2 Grafana │   │ 3.4 Feature │     │
                    │  │ dashboards  │   │ flags YAML  │     │
                    │  └─────────────┘   └─────────────┘     │
                    └─────────────────────────────────────────┘
```

---

## Матрица рисков и митигации

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Tarantool schema изменения ломают существующие данные | Средняя | Высокое | Миграции через ORM, backup перед изменениями |
| RabbitMQ недоступен в тестовом окружении | Низкая | Среднее | In-memory broker для тестов |
| Недостаток ресурсов команды | Средняя | Высокое | Параллельная работа Backend/QA/SRE |
| Регрессии при изменении repositories | Средняя | Высокое | Unit тесты до изменений, review |

---

## Ресурсы

| Роль | Загрузка | Спринты |
|------|----------|---------|
| Backend Developer | 100% | 1, 3-4 |
| QA Engineer | 100% | 2 |
| SRE Engineer | 100% | 3 |
| Frontend Developer | 100% | 4-5 |
| Tech Lead | 20% | Review на всех этапах |

---

## Критерии достижения 95% готовности

### Обязательные (must have) - Спринты 1-3:
- [ ] Все CRUD операции в repositories работают
- [ ] Pydantic response models во всех API endpoints
- [ ] Интеграционные тесты покрывают feedback + RabbitMQ
- [ ] DLQ мониторинг с алертами настроен
- [ ] CI pipeline полностью зелёный

### Желательные P2 (nice to have) - Спринты 4-5:
- [ ] Docstrings на русском языке для всех публичных функций
- [ ] Все API endpoints доступны через UI
- [ ] Таб "Аналитика" с dashboard и trends
- [ ] UX улучшения (loaders, toasts, validation)

---

## Бюджет времени

### MVP (95% готовность) - Спринты 1-3:

| Категория | Человеко-дни |
|-----------|--------------|
| Backend разработка | 5 |
| QA тестирование | 5 |
| SRE/DevOps | 4 |
| Code Review | 1 |
| **Итого MVP** | **15 человеко-дней** |

### Полная готовность - Спринты 4-5:

| Категория | Человеко-дни |
|-----------|--------------|
| Documentation/Refactoring | 1.5 |
| Frontend разработка | 5.5 |
| UX Improvements | 5 |
| Code Review | 1 |
| **Итого P2** | **13 человеко-дней** |

**Общий бюджет:** 28 человеко-дней

---

## API Endpoints для реализации на Frontend (P2)

### Аналитика (новый таб):
| Endpoint | Описание | Приоритет |
|----------|----------|-----------|
| `GET /analytics/dashboard` | Дашборд с метриками | Высокий |
| `GET /analytics/trends` | Тренды анализов | Высокий |
| `POST /analytics/comparison` | Сравнение компаний | Средний |
| `GET /analytics/top-companies` | Топ анализируемых компаний | Средний |

### Управление задачами планировщика:
| Endpoint | Описание | Приоритет |
|----------|----------|-----------|
| `GET /scheduler/tasks` | Список задач | Высокий |
| `GET /scheduler/task/{task_id}` | Детали задачи | Высокий |
| `DELETE /scheduler/task/{task_id}` | Удаление задачи | Высокий |
| `GET /scheduler/stats` | Статистика планировщика | Средний |

### Работа с отчётами:
| Endpoint | Описание | Приоритет |
|----------|----------|-----------|
| `GET /reports/inn/{inn}` | Отчёты по ИНН | Средний |
| `POST /reports/bulk-delete` | Массовое удаление | Средний |
| `GET /reports/{id}/export` | Экспорт отчёта | Высокий |
| `POST /reports/bulk-export` | Массовый экспорт | Средний |

### Работа с потоками анализа:
| Endpoint | Описание | Приоритет |
|----------|----------|-----------|
| `GET /agent/threads` | Список потоков | Средний |
| `GET /agent/thread_history/{id}` | История потока | Средний |
| `GET /agent/analyze/running` | Текущие анализы | Высокий |

---

## UI/UX Рекомендации (консультация с дизайнерами)

### Визуальная иерархия:
- Увеличить контраст между заголовками и контентом
- Добавить типографическую шкалу (H1, H2, body, caption)
- Выделить primary actions визуально

### Пользовательские потоки:
- Progressive disclosure для расширенных настроек
- Skeleton loaders вместо spinner для длительных операций
- Toast-уведомления для feedback вместо inline сообщений

### Формы и валидация:
- Inline валидация с мгновенной обратной связью
- Помощь в заполнении (placeholders, hints)
- Автосохранение черновиков форм

### Навигация:
- Breadcrumbs для глубокой навигации в отчётах
- Сохранение фильтров в URL/session
- Быстрый доступ к недавним анализам

### Accessibility:
- ARIA labels для интерактивных элементов
- Keyboard navigation support
- Проверка контраста (WCAG 2.1 AA)

### Empty states:
- Иллюстрации для пустых списков
- Onboarding tour для новых пользователей
- Quick actions для начала работы

---

## Следующие шаги

1. **Сегодня:** Согласование плана с заказчиком
2. **Завтра:** Kick-off Спринта 1, назначение владельцев задач
3. **Неделя 1:** Backend hardening (P0/P1)
4. **Неделя 2:** QA & Testing (P1)
5. **Неделя 3:** SRE & Observability (P1/P2)
6. **День 16:** Production deployment с уровнем готовности 95%
7. **Недели 4-5:** Frontend & UX (P2) - опционально

---

*Документ подготовлен на основе комплексного анализа системы Client Analyze Agent*  
*UI/UX рекомендации сформированы на основе консультации с командой дизайнеров*
