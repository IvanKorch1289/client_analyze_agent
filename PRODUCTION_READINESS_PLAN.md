# План повышения готовности к Production до 95%

**Проект:** Client Analyze Agent  
**Дата:** 25 декабря 2025  
**Текущий уровень:** 85% (8.5/10)  
**Целевой уровень:** 95% (9.5/10)  
**Срок реализации:** 3 недели (15 рабочих дней)

---

## Executive Summary

Для достижения 95% готовности к production необходимо закрыть 8 ключевых задач в трёх направлениях: Backend, QA и SRE. План разбит на 3 спринта по 5 дней с чёткими критериями успеха.

---

## Текущие пробелы и риски

| Категория | Пробел | Риск для Production | Приоритет |
|-----------|--------|---------------------|-----------|
| Функциональность | TODO методы в repositories | Нет истории аудита, невозможен экспорт | P0 |
| Надёжность | Raw dict вместо Pydantic в health endpoints | Нестабильный API контракт | P1 |
| Тестирование | Нет интеграционных тестов feedback + RabbitMQ | Регрессии в критичных путях | P1 |
| Мониторинг | Нет алертов на DLQ | Потеря сообщений незаметна | P1 |
| Документация | API specs только для 2 из 5 источников | MCP guidance неполный | P2 |
| Конфигурация | Hardcoded feature flags | Сложность управления окружениями | P2 |

---

## План работ по спринтам

### Спринт 1: Backend Hardening (Дни 1-5)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 1.1 | Реализовать методы list, delete, search, count в threads_repository.py | Backend | 2 дня | - |
| 1.2 | Реализовать методы list, delete в cache_repository.py | Backend | 1 день | - |
| 1.3 | Добавить Pydantic response models в utility health/metrics endpoints | Backend | 1 день | 1.1, 1.2 |
| 1.4 | Smoke-тесты Tarantool connectivity | Backend | 1 день | 1.1, 1.2 |

**Критерии успеха Спринта 1:**
- Все CRUD операции в repositories работают
- LSP ошибки типизации устранены
- Tarantool smoke-тесты проходят в CI

---

### Спринт 2: QA & Testing (Дни 6-10)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 2.1 | Интеграционные тесты feedback API с rerun=true | QA | 1.5 дня | Спринт 1 |
| 2.2 | Интеграционные тесты RabbitMQ (publish, consume, DLQ) | QA | 1.5 дня | Спринт 1 |
| 2.3 | E2E тест полного workflow (INN → PDF report) | QA | 1 день | 2.1, 2.2 |
| 2.4 | Настройка test harness с in-memory broker | QA | 1 день | - |

**Критерии успеха Спринта 2:**
- Тестовое покрытие критичных путей > 80%
- CI pipeline зелёный на всех тестах
- Время выполнения тестов < 5 минут

---

### Спринт 3: SRE & Observability (Дни 11-15)

| # | Задача | Владелец | Трудозатраты | Зависимости |
|---|--------|----------|--------------|-------------|
| 3.1 | DLQ мониторинг: Prometheus gauges + alert rules | SRE | 1.5 дня | Спринт 2 |
| 3.2 | Dashboard tiles для DLQ в Grafana | SRE | 0.5 дня | 3.1 |
| 3.3 | API specs для Perplexity, Tavily, InfoSphere | SRE/Docs | 1.5 дня | - |
| 3.4 | Миграция FeatureFlags в YAML/Settings | Backend | 1 день | - |
| 3.5 | Документация change management | SRE | 0.5 дня | 3.4 |

**Критерии успеха Спринта 3:**
- Алерты на DLQ срабатывают при накоплении > 10 сообщений
- MCP server имеет specs для всех 5 API источников
- Feature flags управляются через конфигурацию

---

## Диаграмма зависимостей

```
                    ┌─────────────────────────────────────────┐
                    │           СПРИНТ 1 (Backend)            │
                    │                                         │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 1.1 threads │   │ 1.2 cache   │     │
                    │  │ repository  │   │ repository  │     │
                    │  └──────┬──────┘   └──────┬──────┘     │
                    │         │                 │            │
                    │         └────────┬────────┘            │
                    │                  ▼                     │
                    │         ┌─────────────────┐            │
                    │         │ 1.3 Pydantic    │            │
                    │         │ responses       │            │
                    │         └────────┬────────┘            │
                    │                  │                     │
                    │                  ▼                     │
                    │         ┌─────────────────┐            │
                    │         │ 1.4 Smoke tests │            │
                    │         └────────┬────────┘            │
                    └──────────────────┼─────────────────────┘
                                       │
                                       ▼
                    ┌─────────────────────────────────────────┐
                    │           СПРИНТ 2 (QA)                 │
                    │                                         │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 2.1 feedback│   │ 2.2 RabbitMQ│     │
                    │  │ tests       │   │ tests       │     │
                    │  └──────┬──────┘   └──────┬──────┘     │
                    │         │                 │            │
                    │         └────────┬────────┘            │
                    │                  ▼                     │
                    │         ┌─────────────────┐            │
                    │         │ 2.3 E2E workflow│            │
                    │         └────────┬────────┘            │
                    └──────────────────┼─────────────────────┘
                                       │
                                       ▼
                    ┌─────────────────────────────────────────┐
                    │           СПРИНТ 3 (SRE)                │
                    │                                         │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 3.1 DLQ     │   │ 3.3 API     │     │
                    │  │ monitoring  │   │ specs       │     │
                    │  └──────┬──────┘   └─────────────┘     │
                    │         │                              │
                    │         ▼                              │
                    │  ┌─────────────┐   ┌─────────────┐     │
                    │  │ 3.2 Grafana │   │ 3.4 Feature │     │
                    │  │ dashboards  │   │ flags YAML  │     │
                    │  └─────────────┘   └─────────────┘     │
                    └─────────────────────────────────────────┘
```

---

## Матрица рисков и митигации

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Tarantool schema изменения ломают существующие данные | Средняя | Высокое | Миграции через ORM, backup перед изменениями |
| RabbitMQ недоступен в тестовом окружении | Низкая | Среднее | In-memory broker для тестов |
| Недостаток ресурсов команды | Средняя | Высокое | Параллельная работа Backend/QA/SRE |
| Регрессии при изменении repositories | Средняя | Высокое | Unit тесты до изменений, review |

---

## Ресурсы

| Роль | Загрузка | Спринты |
|------|----------|---------|
| Backend Developer | 100% | 1, частично 3 |
| QA Engineer | 100% | 2 |
| SRE Engineer | 100% | 3 |
| Tech Lead | 20% | Review на всех этапах |

---

## Критерии достижения 95% готовности

### Обязательные (must have):
- [ ] Все CRUD операции в repositories работают
- [ ] Pydantic response models во всех API endpoints
- [ ] Интеграционные тесты покрывают feedback + RabbitMQ
- [ ] DLQ мониторинг с алертами настроен
- [ ] CI pipeline полностью зелёный

### Желательные (nice to have):
- [ ] API specs для всех 5 источников данных
- [ ] Feature flags в YAML конфигурации
- [ ] E2E тест полного workflow
- [ ] Grafana dashboard для DLQ

---

## Бюджет времени

| Категория | Человеко-дни |
|-----------|--------------|
| Backend разработка | 5 |
| QA тестирование | 5 |
| SRE/DevOps | 4 |
| Code Review | 1 |
| **Итого** | **15 человеко-дней** |

---

## Следующие шаги

1. **Сегодня:** Согласование плана с заказчиком
2. **Завтра:** Kick-off Спринта 1, назначение владельцев задач
3. **Неделя 1:** Backend hardening
4. **Неделя 2:** QA & Testing
5. **Неделя 3:** SRE & Observability
6. **День 16:** Production deployment с уровнем готовности 95%

---

*Документ подготовлен на основе комплексного анализа системы Client Analyze Agent*
