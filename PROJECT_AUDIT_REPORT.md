# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ü–†–û–ï–ö–¢–ê: –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–î–∞—Ç–∞:** 2025-12-18  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω—ã

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ‚ö†Ô∏è

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–°—Ç–∞—Ä–∞—è:** `app/settings.py` (93 —Å—Ç—Ä–æ–∫–∏, DEPRECATED)
- **–ù–æ–≤–∞—è:** `app/config/` (1719 —Å—Ç—Ä–æ–∫, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å Vault/Env/YAML)

**–ò—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞—Ä—ã–π settings.py:**
1. `app/agents/llm_init.py` ‚úó
2. `app/services/perplexity_client.py` ‚úó
3. `app/services/tavily_client.py` ‚úó
4. `app/services/openrouter_client.py` ‚úó
5. `app/services/email_client.py` ‚úó
6. `app/services/fetch_data.py` ‚úó
7. `app/storage/tarantool.py` ‚úó

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Confusion –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –†–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π settings.py

---

### 2. –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ô WORKFLOW (—Å—Ç–∞—Ä—ã–π) ‚ö†Ô∏è

**–§–∞–π–ª—ã-–∑–æ–º–±–∏:**
- `app/agents/workflow.py` - —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ LangGraph (127 —Å—Ç—Ä–æ–∫) ‚úó
- `app/agents/planner.py` - —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (82 —Å—Ç—Ä–æ–∫–∏) ‚úó
- `app/agents/analyzer.py` - —Å—Ç–∞—Ä—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ (36 —Å—Ç—Ä–æ–∫) ‚úó
- `app/agents/executor.py` - —Å—Ç–∞—Ä—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (55 —Å—Ç—Ä–æ–∫) ‚úó

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ:**
- `app/agents/client_workflow.py` - –†–ï–ê–õ–¨–ù–´–ô workflow ‚úì
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `app/api/routes/agent.py` –¥–ª—è `/agent/prompt`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°—Ç–∞—Ä—ã–π workflow –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è endpoint `/agent/prompt`
- –≠—Ç–æ—Ç endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM (GigaChat/HuggingFace), –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- Endpoint —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤—Å–µ–≥–¥–∞ 503 –æ—à–∏–±–∫–∞)

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã workflow, —É–¥–∞–ª–∏—Ç—å `/agent/prompt` endpoint

---

### 3. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –ò–ù–ù ‚ö†Ô∏è

**–î—É–±–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ validate_inn:**

1. **`app/utility/helpers.py:19-60`** - –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –≤–µ—Ä—Å–∏—è ‚úì
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã –¥–ª—è 10 –∏ 12 —Ü–∏—Ñ—Ä
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
   - 42 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞

2. **`app/api/routes/data.py:23-25`** - –£–ü–†–û–©–ï–ù–ù–ê–Ø –≤–µ—Ä—Å–∏—è ‚úó
   - –¢–æ–ª—å–∫–æ regex –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
   - 3 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
   - –£–°–¢–ê–†–ï–í–®–ê–Ø

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª—å –∏–∑ data.py, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å helpers.validate_inn

---

### 4. –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï LLM –ü–†–û–í–ê–ô–î–ï–†–´ ‚ö†Ô∏è

**–í `app/agents/llm_init.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 3 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
1. `_OpenRouterProvider` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `settings.openrouter_api_key` ‚úì
2. `_HuggingFaceProvider` - –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø ‚úó
3. `_GigaChatProvider` - –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø ‚úó

**–ü—Ä–æ–±–ª–µ–º—ã:**
- HuggingFace –∏ GigaChat —Ç–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- Fallback chain –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω (—Ç–æ–ª—å–∫–æ OpenRouter —Ä–∞–±–æ—Ç–∞–µ—Ç)
- 100+ —Å—Ç—Ä–æ–∫ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è –≤ settings: `hugging_face_token` (—Å –æ–ø–µ—á–∞—Ç–∫–æ–π `huging_face_model`)

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ OpenRouter

---

### 5. MCP SERVER –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø ‚ö†Ô∏è

**–§–∞–π–ª—ã:**
- `app/mcp_server/server.py` (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞)
- `app/mcp_server/tools.py` (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ `app/main.py:144`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–º workflow (planner.py, executor.py)
- –°—Ç–∞—Ä—ã–π workflow –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø
- **MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞**

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å MCP —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ "planned feature"

---

## üü° –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 6. –û–¢–°–£–¢–°–¢–í–ò–ï –ú–ò–ì–†–ê–¶–ò–ò –ù–ê –ö–û–ù–°–¢–ê–ù–¢–´

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `app/config/constants.py`, –Ω–æ –∫–æ–¥ –∏—Ö –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
# app/agents/data_collector.py:19-21
MAX_CONCURRENT = 5  # –•–ê–†–î–ö–û–î ‚úó
SEARCH_TIMEOUT = 60  # –•–ê–†–î–ö–û–î ‚úó
MAX_WEB_CONTENT_CHARS = 2500  # –•–ê–†–î–ö–û–î ‚úó

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
from app.config import MAX_CONCURRENT_SEARCHES, SEARCH_TIMEOUT_SECONDS
```

**–§–∞–π–ª—ã —Å —Ö–∞—Ä–¥–∫–æ–¥–æ–º:**
- `app/agents/data_collector.py`
- `app/agents/client_workflow.py`
- `app/frontend/app.py` (—Ç–∞–π–º–∞—É—Ç—ã –≤ request_with_retry)

**–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏–∑ config

---

### 7. –û–¢–°–£–¢–°–¢–í–ò–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –ù–û–í–û–ô CONFIG

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–Ω–∞ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–ß—Ç–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `app/config/database.py` - TarantoolConnectionSettings ‚úó
- `app/config/external_api.py` - DadataAPISettings, PerplexityAPISettings, –∏ —Ç.–¥. ‚úó
- `app/config/services.py` - QueueSettings, RedisSettings, MailSettings ‚úó
- `app/config/security.py` - SecureSettings ‚úó

**–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–π `app/settings.py` ‚úó

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ –Ω–æ–≤—É—é config

---

### 8. –ù–ï–ü–û–õ–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø RABBITMQ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Docker Compose –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚úì
- QueueSettings —Å–æ–∑–¥–∞–Ω—ã ‚úì
- FastStream –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω ‚úó
- –û—á–µ—Ä–µ–¥–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚úó

**–†–µ—à–µ–Ω–∏–µ:** –õ–∏–±–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, –ª–∏–±–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±—Ä–∞—Ç—å –∏–∑ depends_on

---

### 9. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –õ–û–ì–ò–ö–ò –ö–ï–®–ò–†–û–í–ê–ù–ò–Ø

**–ù–∞–π–¥–µ–Ω—ã 3 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∫–µ—à–∞:**
1. **TarantoolClient** (–≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–µ—à) ‚úì
2. **PerplexityClient._cache** (in-memory dict) ‚úó
3. **TavilyClient._cache** (in-memory dict) ‚úó

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Perplexity –∏ Tavily –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ dict –±–µ–∑ LRU
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ ‚Üí –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TarantoolClient –¥–ª—è –≤—Å–µ—Ö –∫–µ—à–µ–π

---

## üü¢ –ú–ï–õ–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 10. –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è –≤ settings.py

```python
# app/settings.py:36-44
hugging_face_token  # DEPRECATED ‚úó
huging_face_model   # –û–ü–ï–ß–ê–¢–ö–ê –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏! ‚úó
huggingface_token   # Canonical
huggingface_model   # Canonical
```

---

### 11. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ config_loader.py

```python
# app/config/config_loader.py:7
from typing import Type, TypeVar
T = TypeVar("T", bound=BaseSettings)  # –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚úó
```

---

### 12. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä—ã:**
- `app/agents/data_collector.py:232` - `async def _bounded(coro)` –±–µ–∑ —Ç–∏–ø–æ–≤
- `app/utility/logging_client.py:134` - `def _truncate(self, text, max_len)` –±–µ–∑ —Ç–∏–ø–æ–≤

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ú–ï–†–¢–í–û–ì–û –ö–û–î–ê

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –§–∞–π–ª—ã | –°—Ç—Ä–æ–∫ | –°—Ç–∞—Ç—É—Å |
|-----------|-------|-------|--------|
| –°—Ç–∞—Ä—ã–π settings.py | 1 | 93 | ‚ùå –£–¥–∞–ª–∏—Ç—å |
| –°—Ç–∞—Ä—ã–π workflow | 4 | 300 | ‚ùå –£–¥–∞–ª–∏—Ç—å |
| MCP Server | 2 | ~400 | ‚ö†Ô∏è –†–µ—à–∏—Ç—å |
| –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã | 1 | 100 | ‚ùå –£–¥–∞–ª–∏—Ç—å |
| –î—É–±–ª–∏ validate_inn | 1 | 3 | ‚ùå –£–¥–∞–ª–∏—Ç—å |

**–í—Å–µ–≥–æ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞:** ~896 —Å—Ç—Ä–æ–∫ (18% –æ—Ç –≤—Å–µ–≥–æ –∫–æ–¥–∞)

---

## üìã –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –§–ê–ó–ê 1: –£–î–ê–õ–ï–ù–ò–ï –ú–ï–†–¢–í–û–ì–û –ö–û–î–ê (2-3 —á–∞—Å–∞)

#### –®–∞–≥ 1.1: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π workflow
- [ ] –£–¥–∞–ª–∏—Ç—å `app/agents/workflow.py`
- [ ] –£–¥–∞–ª–∏—Ç—å `app/agents/planner.py`
- [ ] –£–¥–∞–ª–∏—Ç—å `app/agents/analyzer.py`
- [ ] –£–¥–∞–ª–∏—Ç—å `app/agents/executor.py`
- [ ] –£–¥–∞–ª–∏—Ç—å endpoint `/agent/prompt` –∏–∑ `app/api/routes/agent.py`
- [ ] –£–¥–∞–ª–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `app/api/routes/agent.py`

#### –®–∞–≥ 1.2: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- [ ] –£–¥–∞–ª–∏—Ç—å `_HuggingFaceProvider` –∏–∑ `llm_init.py`
- [ ] –£–¥–∞–ª–∏—Ç—å `_GigaChatProvider` –∏–∑ `llm_init.py`
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å `FallbackLLM` (—Ç–æ–ª—å–∫–æ OpenRouter)
- [ ] –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ settings.py

#### –®–∞–≥ 1.3: –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏
- [ ] –£–¥–∞–ª–∏—Ç—å `validate_inn()` –∏–∑ `app/api/routes/data.py`
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `app/utility/helpers`

#### –®–∞–≥ 1.4: –†–µ—à–∏—Ç—å —Å—É–¥—å–±—É MCP Server
**–í–∞—Ä–∏–∞–Ω—Ç A:** –£–¥–∞–ª–∏—Ç—å (–µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [ ] –£–¥–∞–ª–∏—Ç—å `app/mcp_server/`
- [ ] –£–±—Ä–∞—Ç—å –∑–∞–ø—É—Å–∫ –∏–∑ `app/main.py`

**–í–∞—Ä–∏–∞–Ω—Ç B:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "planned feature"
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "# TODO: MCP Server - planned for future use"
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ README

---

### –§–ê–ó–ê 2: –ú–ò–ì–†–ê–¶–ò–Ø –ù–ê –ù–û–í–£–Æ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Æ (4-5 —á–∞—Å–æ–≤)

#### –®–∞–≥ 2.1: –ú–∏–≥—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö API
- [ ] `app/services/perplexity_client.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.perplexity.*`
- [ ] `app/services/tavily_client.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.tavily.*`
- [ ] `app/services/openrouter_client.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.openrouter.*`
- [ ] `app/services/email_client.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.mail.*`
- [ ] `app/services/fetch_data.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.dadata.*`, `settings.casebook.*`, `settings.infosphere.*`

#### –®–∞–≥ 2.2: –ú–∏–≥—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â
- [ ] `app/storage/tarantool.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.tarantool.*`

#### –®–∞–≥ 2.3: –ú–∏–≥—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
- [ ] `app/agents/llm_init.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.openrouter.*`
- [ ] `app/agents/data_collector.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ config
- [ ] `app/agents/client_workflow.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

#### –®–∞–≥ 2.4: –ú–∏–≥—Ä–∞—Ü–∏—è main.py
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.app.*` –¥–ª—è ports, workers, etc.
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.secure.*` –¥–ª—è CORS, rate limiting

#### –®–∞–≥ 2.5: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ settings.py
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ
- [ ] –£–¥–∞–ª–∏—Ç—å `app/settings.py`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤–µ–∑–¥–µ

---

### –§–ê–ó–ê 3: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (3-4 —á–∞—Å–∞)

#### –®–∞–≥ 3.1: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –£–¥–∞–ª–∏—Ç—å `_cache` –∏–∑ PerplexityClient
- [ ] –£–¥–∞–ª–∏—Ç—å `_cache` –∏–∑ TavilyClient
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TarantoolClient –¥–ª—è –≤—Å–µ—Ö –∫–µ—à–µ–π
- [ ] –ò–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å LRU cache —Å max_size

#### –®–∞–≥ 3.2: Tarantool spaces
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `app/storage/init.lua` (—Å–æ–∑–¥–∞—Ç—å spaces: cache, reports, threads)
- [ ] –°–æ–∑–¥–∞—Ç—å Repository pattern:
  - `app/storage/repositories/cache_repository.py`
  - `app/storage/repositories/reports_repository.py`
  - `app/storage/repositories/threads_repository.py`
- [ ] –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ repositories

#### –®–∞–≥ 3.3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≤–µ–∑–¥–µ
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ —Ö–∞—Ä–¥–∫–æ–¥—ã –Ω–∞ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `app/config`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TimeoutConfig` –¥–ª—è —Ç–∞–π–º–∞—É—Ç–æ–≤
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `RiskLevel`, `RiskThresholds` –≤ –æ—Ç—á–µ—Ç–∞—Ö

#### –®–∞–≥ 3.4: Streamlit —É–ª—É—á—à–µ–Ω–∏—è
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é config –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∫–∞–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–æ—Å—å)
- [ ] Real-time updates —á–µ—Ä–µ–∑ SSE

---

### –§–ê–ó–ê 4: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø RABBITMQ (3-4 —á–∞—Å–∞)

#### –®–∞–≥ 4.1: FastStream setup
- [ ] –°–æ–∑–¥–∞—Ç—å `app/queue/broker.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `settings.queue.*`

#### –®–∞–≥ 4.2: –°–æ–∑–¥–∞—Ç—å publishers/subscribers
- [ ] Publisher –¥–ª—è `/agent/analyze-client`
- [ ] Subscriber –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–Ω–∞–ª–∏–∑–∞
- [ ] –û—á–µ—Ä–µ–¥–∏: analysis.client, reports.generate, notifications.email

#### –®–∞–≥ 4.3: Async processing
- [ ] –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å analyze-client –Ω–∞ async —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
- [ ] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç task_id
- [ ] –ù–æ–≤—ã–π endpoint `/agent/task/{task_id}` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

---

## üéØ –ò–¢–û–ì–û–í–´–ï –ú–ï–¢–†–ò–ö–ò

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~5,000
- **–ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥:** ~896 (18%)
- **–î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥:** ~150 —Å—Ç—Ä–æ–∫
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–π config:** 7 —Ñ–∞–π–ª–æ–≤
- **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** ~300 —Å—Ç—Ä–æ–∫

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è):
- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~4,000 (-20%)
- **–ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥:** 0 (0%)
- **–î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥:** 0
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π config:** 100%
- **Test coverage:** >80%

---

## ‚è±Ô∏è –û–¶–ï–ù–ö–ê –í–†–ï–ú–ï–ù–ò

| –§–∞–∑–∞ | –ó–∞–¥–∞—á–∏ | –í—Ä–µ–º—è |
|------|--------|-------|
| –§–∞–∑–∞ 1: –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ | 4 —à–∞–≥–∞ | 2-3 —á |
| –§–∞–∑–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é config | 5 —à–∞–≥–æ–≤ | 4-5 —á |
| –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | 4 —à–∞–≥–∞ | 3-4 —á |
| –§–∞–∑–∞ 4: RabbitMQ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 3 —à–∞–≥–∞ | 3-4 —á |
| **–í—Å–µ–≥–æ** | **16 —à–∞–≥–æ–≤** | **12-16 —á** |

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–§–∞–∑–∞ 1):
1. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π workflow - –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤–≤–æ–¥–∏—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ
2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
3. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏ —Ñ—É–Ω–∫—Ü–∏–π

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 2):
4. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π settings.py
6. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 3):
7. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
8. –°–æ–∑–¥–∞—Ç—å Tarantool repositories
9. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–µ–∑–¥–µ

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 4):
10. –ó–∞–≤–µ—Ä—à–∏—Ç—å RabbitMQ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ù–∞—á–∞—Ç—å —Å –§–∞–∑—ã 1 - —É–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞
